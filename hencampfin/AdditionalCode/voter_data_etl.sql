### voter list table with additional attributes

select
b.CountyCode,
upper(a.COUNTYNAME) as CountyName,
FirstName,
MiddleName,
LastName,
NameSuffix,
HouseNumber,
StreetName,
UnitType,
UnitNumber,
Address2,
City,
State,
ZipCode,
MailAddress,
MailCity,
MailState,
MailZipCode,
PhoneNumber,
RegistrationDate,
DOBYear,
StateMcdCode,
upper(b.McdName) as MCDName,
PrecinctCode,
PrecinctName,
WardCode,
School,
SchSub,
Judicial,
Legislative,
StateSen,
Congressional,
Commissioner,
Park,
SoilWater,
Hospital,
LegacyId,
voterid,
yr1993,
yr1994,
yr1995,
yr1996,
yr1997,
yr1998,
yr1999,
yr2000,
yr2001,
yr2002,
yr2003,
yr2004,
yr2005,
yr2006,
yr2007,
yr2008,
yr2009,
yr2010,
yr2011,
yr2012,
yr2013,
yr2014,
yr2015,
yr2016,
yr2017,
yr2018
from
campaign.MN_PRECINCT_LOC_DIM a right outer join
campaign.MN_VOTERS_ELECTION_ByYear_WithAttrib b on (a.PCTCODE = b.PrecinctCode and a.COUNTYCODE = cast(b.CountyCode as int64) )



### Combine election results data for year 2016,2014 & 2012

Select
VTDID as VTDID,
Upper(PCTNAME) as PCTNAME,
PCTCODE as PCTCODE,
Upper(MCDNAME) as MCDNAME,
Upper(COUNTYNAME) as COUNTYNAME,
COUNTYCODE as COUNTYCODE,
CONGDIST as CONGDIST,
MNSENDIST as MNSENDIST,
MNLEGDIST as MNLEGDIST,
CTYCOMDIST as CTYCOMDIST,
JUDDIST as JUDDIST,
SWCDIST as SWCDIST,
WARD as WARD,
HOSPDIST as HOSPDIST,
PARKDIST as PARKDIST,
TABSYSTEM as TABSYSTEM,
TABMODEL as TABMODEL,
MAILBALLOT as MAILBALLOT,
REG7AM as REG7AM,
EDR as EDR,
SIGNATURES as SIGNATURES,
AB_MB as AB_MB,
FEDONLYAB as FEDONLYAB,
PRESONLYAB as PRESONLYAB,
TOTVOTING as TOTVOTING,
USPRSR as USPRSR,
USPRSDFL as USPRSDFL,
USPRSLIB as USPRSLIB,
USPRSSWP as USPRSSWP,
USPRSCP as USPRSCP,
USPRSLMN as USPRSLMN,
0 as USPRSCG,
USPRSGP as USPRSGP,
USPRSADP as USPRSADP,
USPRSIP as USPRSIP,
0 as USPRSGR,
0 as USPRSSL,
0 as USPRSJP,
USPRSWI as USPRSWI,
USPRSTOTAL as USPRSTOTAL,
0 as USREPIP,
USREPR as USREPR,
USREPDFL as USREPDFL,
USREPWI as USREPWI,
USREPTOTAL as USREPTOTAL,
0 as MNSENIP,
MNSENR as MNSENR,
MNSENDFL as MNSENDFL,
MNSENWI as MNSENWI,
MNSENTOTAL as MNSENTOTAL,
0 as MNLEGIP,
MNLEGR as MNLEGR,
MNLEGDFL as MNLEGDFL,
MNLEGWI as MNLEGWI,
MNLEGTOTAL as MNLEGTOTAL,
0 as USSENIP,
0 as USSENR,
0 as USSENDFL,
0 as USSENGR,
0 as USSENMOP,
0 as USSENLIB,
0 as USSENWI,
0 as USSENTOTAL,
0 as MNGOVIP,
0 as MNGOVR,
0 as MNGOVDFL,
0 as MNGOVLIB,
0 as MNGOVGLC,
0 as MNGOVWI,
0 as MNGOVTOTAL,
0 as MNSOSIP,
0 as MNSOSR,
0 as MNSOSDFL,
0 as MNSOSLIB,
0 as MNSOSWI,
0 as MNSOSTOTAL,
0 as MNAUDIP,
0 as MNAUDR,
0 as MNAUDDFL,
0 as MNAUDLIB,
0 as MNAUDGLC,
0 as MNAUDWI,
0 as MNAUDTOTAL,
0 as MNAGIP,
0 as MNAGR,
0 as MNAGDFL,
0 as MNAGGP,
0 as MNAGLIB,
0 as MNAGLMN,
0 as MNAGWI,
0 as MNAGTOTAL,
MNCA1YES as MNCA1YES,
MNCA1NO as MNCA1NO,
MNCA1EST as MNCA1EST,
MNCA1TOTAL as MNCA1TOTAL,
0 as MNCA2YES,
0 as MNCA2NO,
0 as MNCA2EST,
0 as MNCA2TOTAL,
2016 as ELECTIONYR
From campaign.MN_ELECTION_RESULTS_2016
Where PCTNAME is not null
UNION ALL
Select
VTDID as VTDID,
Upper(PCTNAME) as PCTNAME,
PCTCODE as PCTCODE,
Upper(MCDNAME) as MCDNAME,
Upper(COUNTYNAME) as COUNTYNAME,
COUNTYCODE as COUNTYCODE,
CONGDIST as CONGDIST,
MNSENDIST as MNSENDIST,
MNLEGDIST as MNLEGDIST,
CTYCOMDIST as CTYCOMDIST,
JUDDIST as JUDDIST,
SWCDIST as SWCDIST,
WARD as WARD,
HOSPDIST as HOSPDIST,
PARKDIST as PARKDIST,
TABSYSTEM as TABSYSTEM,
TABMODEL as TABMODEL,
MAILBALLOT as MAILBALLOT,
REG7AM as REG7AM,
EDR as EDR,
SIGNATURES as SIGNATURES,
AB_MB as AB_MB,
FEDONLYAB as FEDONLYAB,
0 as PRESONLYAB,
TOTVOTING as TOTVOTING,
0 as USPRSR,
0 as USPRSDFL,
0 as USPRSLIB,
0 as USPRSSWP,
0 as USPRSCP,
0 as USPRSLMN,
0 as USPRSCG,
0 as USPRSGP,
0 as USPRSADP,
0 as USPRSIP,
0 as USPRSGR,
0 as USPRSSL,
0 as USPRSJP,
0 as USPRSWI,
0 as USPRSTOTAL,
USREPIP as USREPIP,
USREPR as USREPR,
USREPDFL as USREPDFL,
USREPWI as USREPWI,
USREPTOTAL as USREPTOTAL,
0 as MNSENIP,
0 as MNSENR,
0 as MNSENDFL,
0 as MNSENWI,
0 as MNSENTOTAL,
MNLEGIP as MNLEGIP,
MNLEGR as MNLEGR,
MNLEGDFL as MNLEGDFL,
MNLEGWI as MNLEGWI,
MNLEGTOTAL as MNLEGTOTAL,
USSENIP as USSENIP,
USSENR as USSENR,
USSENDFL as USSENDFL,
0 as USSENGR,
0 as USSENMOP,
USSENLIB as USSENLIB,
USSENWI as USSENWI,
USSENTOTAL as USSENTOTAL,
MNGOVIP as MNGOVIP,
MNGOVR as MNGOVR,
MNGOVDFL as MNGOVDFL,
MNGOVLIB as MNGOVLIB,
MNGOVGLC as MNGOVGLC,
MNGOVWI as MNGOVWI,
MNGOVTOTAL as MNGOVTOTAL,
MNSOSIP as MNSOSIP,
MNSOSR as MNSOSR,
MNSOSDFL as MNSOSDFL,
MNSOSLIB as MNSOSLIB,
MNSOSWI as MNSOSWI,
MNSOSTOTAL as MNSOSTOTAL,
MNAUDIP as MNAUDIP,
MNAUDR as MNAUDR,
MNAUDDFL as MNAUDDFL,
MNAUDLIB as MNAUDLIB,
MNAUDGLC as MNAUDGLC,
MNAUDWI as MNAUDWI,
MNAUDTOTAL as MNAUDTOTAL,
MNAGIP as MNAGIP,
MNAGR as MNAGR,
MNAGDFL as MNAGDFL,
MNAGGP as MNAGGP,
MNAGLIB as MNAGLIB,
MNAGLMN as MNAGLMN,
MNAGWI as MNAGWI,
MNAGTOTAL as MNAGTOTAL,
0 as MNCA1YES,
0 as MNCA1NO,
0 as MNCA1EST,
0 as MNCA1TOTAL,
0 as MNCA2YES,
0 as MNCA2NO,
0 as MNCA2EST,
0 as MNCA2TOTAL,
2014 as ELECTIONYR
From campaign.MN_ELECTION_RESULTS_2014
Where PCTNAME is not null
UNION ALL
Select
VTDID as VTDID,
Upper(PCTNAME) as PCTNAME,
PCTCODE as PCTCODE,
Upper(MCDNAME) as MCDNAME,
Upper(COUNTYNAME) as COUNTYNAME,
COUNTYCODE as COUNTYCODE,
CONGDIST as CONGDIST,
MNSENDIST as MNSENDIST,
MNLEGDIST as MNLEGDIST,
CTYCOMDIST as CTYCOMDIST,
JUDDIST as JUDDIST,
SWCDIST as SWCDIST,
PARKDIST as WARD,
HOSPDIST as HOSPDIST,
WARD as PARKDIST,
TABSYSTEM as TABSYSTEM,
TABMODEL as TABMODEL,
MAILBALLOT as MAILBALLOT,
_7AM as REG7AM,
EDR as EDR,
SIGNATURES as SIGNATURES,
REGMILOVAB as AB_MB,
FEDONLYAB as FEDONLYAB,
PRESONLYAB as PRESONLYAB,
TOTVOTING as TOTVOTING,
USPRSR as USPRSR,
USPRSDFL as USPRSDFL,
USPRSLIB as USPRSLIB,
USPRSSWP as USPRSSWP,
USPRSCP as USPRSCP,
0 as USPRSLMN,
USPRSCG as USPRSCG,
USPRSGP as USPRSGP,
0 as USPRSADP,
0 as USPRSIP,
USPRSGR as USPRSGR,
USPRSSL as USPRSSL,
USPRSJP as USPRSJP,
USPRSWI as USPRSWI,
USPRSTOTAL as USPRSTOTAL,
USREPIP as USREPIP,
USREPR as USREPR,
USREPDFL as USREPDFL,
USREPWI as USREPWI,
USREPTOTAL as USREPTOTAL,
MNSENIP as MNSENIP,
MNSENR as MNSENR,
MNSENDFL as MNSENDFL,
MNSENWI as MNSENWI,
MNSENTOTAL as MNSENTOTAL,
MNLEGIP as MNLEGIP,
MNLEGR as MNLEGR,
MNLEGDFL as MNLEGDFL,
MNLEGWI as MNLEGWI,
MNLEGTOTAL as MNLEGTOTAL,
USSENIP as USSENIP,
USSENR as USSENR,
USSENDFL as USSENDFL,
USSENGR as USSENGR,
USSENMOP as USSENMOP,
0 as USSENLIB,
USSENWI as USSENWI,
USSENTOTAL as USSENTOTAL,
0 as MNGOVIP,
0 as MNGOVR,
0 as MNGOVDFL,
0 as MNGOVLIB,
0 as MNGOVGLC,
0 as MNGOVWI,
0 as MNGOVTOTAL,
0 as MNSOSIP,
0 as MNSOSR,
0 as MNSOSDFL,
0 as MNSOSLIB,
0 as MNSOSWI,
0 as MNSOSTOTAL,
0 as MNAUDIP,
0 as MNAUDR,
0 as MNAUDDFL,
0 as MNAUDLIB,
0 as MNAUDGLC,
0 as MNAUDWI,
0 as MNAUDTOTAL,
0 as MNAGIP,
0 as MNAGR,
0 as MNAGDFL,
0 as MNAGGP,
0 as MNAGLIB,
0 as MNAGLMN,
0 as MNAGWI,
0 as MNAGTOTAL,
MNCA1YES as MNCA1YES,
MNCA1NO as MNCA1NO,
MNCA1EST as MNCA1EST,
MNCA1TOTAL as MNCA1TOTAL,
MNCA2YES as MNCA2YES,
MNCA2NO as MNCA2NO,
MNCA2EST as MNCA2EST,
MNCA2TOTAL as MNCA2TOTAL,
2012 as ELECTIONYR
From campaign.MN_ELECTION_RESULTS_2012
Where PCTCODE is not null




#####  Get lat long for election results data
##### This needs to be fixed with the join on all 3 columne which incluedes MNLEGCode


select VTDID,
PCTNAME as precinct_nm,
PCTCODE,
MCDNAME as subdivision_nm,
COUNTYNAME as  county_nm,
COUNTYCODE,
CONGDIST,
MNSENDIST,
MNLEGDIST,
CTYCOMDIST,
JUDDIST,
SWCDIST,
WARD,
HOSPDIST,
PARKDIST,
TABSYSTEM,
TABMODEL,
MAILBALLOT,
REG7AM as registered_voters,
EDR as registered_voting_day,
SIGNATURES,
AB_MB,
FEDONLYAB,
PRESONLYAB,
TOTVOTING as number_of_votes,
USPRSR as usp_rep_voters,
USPRSDFL as usp_dem_voters,
USPRSLIB,
USPRSSWP,
USPRSCP,
USPRSLMN,
USPRSCG,
USPRSGP,
USPRSADP,
USPRSIP,
USPRSGR,
USPRSSL,
USPRSJP,
USPRSWI,
USPRSTOTAL as pres_tot,
USREPIP,
USREPR as usrep_rep,
USREPDFL as usrep_dfl,
USREPWI ,
USREPTOTAL as usrep_tot,
MNSENIP,
MNSENR as mnsen_rep_voters,
MNSENDFL as mnsen_dfl_voters,
MNSENWI,
MNSENTOTAL as mnsen_tot,
MNLEGIP as mnrep_ip_voters,
MNLEGR as mnrep_rep_voters,
MNLEGDFL as mnrep_dfl_voters,
MNLEGWI,
MNLEGTOTAL as mnrep_tot,
USSENIP,
USSENR,
USSENDFL,
USSENGR,
USSENMOP,
USSENLIB,
USSENWI,
USSENTOTAL,
MNGOVIP,
MNGOVR,
MNGOVDFL,
MNGOVLIB,
MNGOVGLC,
MNGOVWI,
MNGOVTOTAL,
MNSOSIP,
MNSOSR,
MNSOSDFL,
MNSOSLIB,
MNSOSWI,
MNSOSTOTAL,
MNAUDIP,
MNAUDR,
MNAUDDFL,
MNAUDLIB,
MNAUDGLC,
MNAUDWI,
MNAUDTOTAL,
MNAGIP,
MNAGR,
MNAGDFL,
MNAGGP,
MNAGLIB,
MNAGLMN,
MNAGWI,
MNAGTOTAL,
MNCA1YES,
MNCA1NO,
MNCA1EST,
MNCA1TOTAL,
MNCA2YES,
MNCA2NO,
MNCA2EST,
MNCA2TOTAL,
ELECTIONYR ,
concat(cast(PCTCODE as string),cast(COUNTYCODE as string)) as PCTCOUNTYCODE,
'MN' state,
Lat,
Long,
latlong
from
(select
VTDID,
PCTNAME,
PCTCODE,
MCDNAME,
COUNTYNAME,
COUNTYCODE,
CONGDIST,
MNSENDIST,
MNLEGDIST,
CTYCOMDIST,
JUDDIST,
SWCDIST,
WARD,
HOSPDIST,
PARKDIST,
TABSYSTEM,
TABMODEL,
MAILBALLOT,
REG7AM,
EDR,
SIGNATURES,
AB_MB,
FEDONLYAB,
PRESONLYAB,
TOTVOTING,
USPRSR,
USPRSDFL,
USPRSLIB,
USPRSSWP,
USPRSCP,
USPRSLMN,
USPRSCG,
USPRSGP,
USPRSADP,
USPRSIP,
USPRSGR,
USPRSSL,
USPRSJP,
USPRSWI,
USPRSTOTAL,
USREPIP,
USREPR,
USREPDFL,
USREPWI,
USREPTOTAL,
MNSENIP,
MNSENR,
MNSENDFL,
MNSENWI,
MNSENTOTAL,
MNLEGIP,
MNLEGR,
MNLEGDFL,
MNLEGWI,
MNLEGTOTAL,
USSENIP,
USSENR,
USSENDFL,
USSENGR,
USSENMOP,
USSENLIB,
USSENWI,
USSENTOTAL,
MNGOVIP,
MNGOVR,
MNGOVDFL,
MNGOVLIB,
MNGOVGLC,
MNGOVWI,
MNGOVTOTAL,
MNSOSIP,
MNSOSR,
MNSOSDFL,
MNSOSLIB,
MNSOSWI,
MNSOSTOTAL,
MNAUDIP,
MNAUDR,
MNAUDDFL,
MNAUDLIB,
MNAUDGLC,
MNAUDWI,
MNAUDTOTAL,
MNAGIP,
MNAGR,
MNAGDFL,
MNAGGP,
MNAGLIB,
MNAGLMN,
MNAGWI,
MNAGTOTAL,
MNCA1YES,
MNCA1NO,
MNCA1EST,
MNCA1TOTAL,
MNCA2YES,
MNCA2NO,
MNCA2EST,
MNCA2TOTAL,
ELECTIONYR
from campaign.MN_ELECTION_RESULTS_ALL_Temp) mn_results  left outer join
(select
Precinct_nm_upper,
PCTCODE PRECINCT_CODE,
COUNTYCODE COUNTY_CODE,
COUNTYNAME cnty_nm,
Lat,
Long,
latlong
from
`campaign.MN_PRECINCT_LOC_DIM` ) mn_loc
ON mn_results.PCTCODE = mn_loc.PRECINCT_CODE AND mn_results.COUNTYCODE = MN_LOC.COUNTY_CODE


####################### Create demographics table


